
> DM-SFU@0.0.1 test /home/cosmouser/medooze/dm-sfu
> tap tests/*.js --cov

TAP version 13
# Subtest: tests/client.js
    # Subtest: Client::constructor
        # Subtest: getters
            ok 1 - should be equal
            1..1
        ok 1 - getters # time=12.073ms

        1..1
    ok 1 - Client::constructor # time=18.52ms

    # Subtest: Client::room create
        # Subtest: create success
            ok 1 - expect truthy value
            1..1
        ok 1 - create success # time=5.597ms

        # Subtest: create nopin
            ok 1 - should be equal
            1..1
        ok 2 - create nopin # time=2.414ms

        1..2
    ok 2 - Client::room create # time=12.363ms

    # Subtest: Client::room destroy
        # Subtest: destroy success
            ok 1 - (unnamed test)
            1..1
        ok 1 - destroy success # time=6.802ms

        # Subtest: destroy not authorized
            ok 1 - should be equal
            1..1
        ok 2 - destroy not authorized # time=1.225ms

        # Subtest: destroy no room
            ok 1 - should be equal
            1..1
        ok 3 - destroy no room # time=0.739ms

        1..3
    ok 3 - Client::room destroy # time=16.237ms

    # Subtest: Client::participant join
        # Subtest: join success
            ok 1 - expect truthy value
            1..1
        ok 1 - join success # time=14.56ms

        # Subtest: join other success
            ok 1 - expect truthy value
            1..1
        ok 2 - join other success # time=2.433ms

        # Subtest: join no room
            ok 1 - should be equal
            1..1
        ok 3 - join no room # time=1.005ms

        # Subtest: join no pin
            ok 1 - should be equal
            1..1
        ok 4 - join no pin # time=1.283ms

        # Subtest: should not join twice
            ok 1 - should be equal
            1..1
        ok 5 - should not join twice # time=2.148ms

        1..5
    ok 4 - Client::participant join # time=25.15ms

    # Subtest: Client::participant leave
        # Subtest: leave sucess
            ok 1 - expect truthy value
            ok 2 - (unnamed test)
            1..2
        ok 1 - leave sucess # time=7.726ms

        # Subtest: leave no room
            ok 1 - should be equal
            1..1
        ok 2 - leave no room # time=3.313ms

        # Subtest: should not leave twice
            ok 1 - expect truthy value
            ok 2 - should be equal
            1..2
        ok 3 - should not leave twice # time=3.454ms

        1..3
    ok 5 - Client::participant leave # time=18.1ms

    # Subtest: Client::participant kick
        # Subtest: sucess
            ok 1 - (unnamed test)
            1..1
        ok 1 - sucess # time=12.74ms

        # Subtest: no room
            ok 1 - should be equal
            1..1
        ok 2 - no room # time=0.7ms

        # Subtest: not joined
            ok 1 - should be equal
            1..1
        ok 3 - not joined # time=1.153ms

        # Subtest: no participant
            ok 1 - should be equal
            1..1
        ok 4 - no participant # time=24.29ms

        # Subtest: not authorized
            ok 1 - should be equal
            1..1
        ok 5 - not authorized # time=4.253ms

        1..5
    ok 6 - Client::participant kick # time=47.611ms

    # Subtest: Client::participant events
        # Subtest: joined event
            1..2
            ok 1 - should be equal
            ok 2 - should be equal
        ok 1 - joined event # time=16.622ms

        # Subtest: other left event
            1..3
            ok 1 - should be equal
            ok 2 - should be equal
            ok 3 - should be equal
        ok 2 - other left event # time=3.904ms

        # Subtest: other kicked event
            1..3
            ok 1 - should be equal
            ok 2 - should be equal
            ok 3 - should be equal
        ok 3 - other kicked event # time=3.23ms

        # Subtest: kicked event
            1..1
            ok 1 - should be equal
        ok 4 - kicked event # time=2.521ms

        1..4
    ok 7 - Client::participant events # time=33.186ms

    # Subtest: Client::participant streams
        ok 1 - publish # TODO
        ok 2 - subscribe # TODO
        ok 3 - mute # TODO
        ok 4 - mutedtrack # TODO
        1..4
        # todo: 4
    ok 8 - Client::participant streams # time=1.621ms

    1..8
    # time=187.04ms
ok 1 - tests/client.js # time=536.707ms

# Subtest: tests/participant.js
    # Subtest: Participant::constructor
        ok 1 - expect truthy value
        # Subtest: getters
            ok 1 - should be equal
            1..1
        ok 2 - getters # time=9.278ms

        1..2
    ok 1 - Participant::constructor # time=20.242ms

    # Subtest: Participant::start
        # Subtest: sucess
            ok 1 - (unnamed test)
            1..1
        ok 1 - sucess # time=9.091ms

        # Subtest: double
            ok 1 - (unnamed test)
            1..1
        ok 2 - double # time=1.374ms

        # Subtest: fail
            ok 1 - (unnamed test)
            1..1
        ok 3 - fail # time=0.9ms

        1..3
    ok 2 - Participant::start # time=15.219ms

    # Subtest: Participant::publish
        # Subtest: success
            ok 1 - should be equal
            ok 2 - should be equal
            ok 3 - should be equal
            ok 4 - should be equal
            ok 5 - should be equal
            ok 6 - should be equal
            ok 7 - (unnamed test)
            1..7
        ok 1 - success # time=7.748ms

        # Subtest: duplicated
            ok 1 - (unnamed test)
            ok 2 - should be equal
            ok 3 - (unnamed test)
            1..3
        ok 2 - duplicated # time=2.987ms

        # Subtest: removeTrack
            ok 1 - should be equal
            ok 2 - should be equal
            ok 3 - should be equal
            ok 4 - should be equal
            ok 5 - should be equal
            ok 6 - (unnamed test)
            1..6
        ok 3 - removeTrack # time=3.67ms

        # Subtest: unpublish
            ok 1 - should be equal
            ok 2 - (unnamed test)
            ok 3 - should be equal
            1..3
        ok 4 - unpublish # time=3.644ms

        # Subtest: audio only
            ok 1 - should be equal
            ok 2 - should be equal
            ok 3 - should be equal
            ok 4 - should be equal
            ok 5 - should be equal
            ok 6 - (unnamed test)
            1..6
        ok 5 - audio only # time=4.31ms

        # Subtest: addTrack
            ok 1 - should be equal
            ok 2 - should be equal
            ok 3 - should be equal
            ok 4 - should be equal
            ok 5 - should be equal
            ok 6 - should be equal
            ok 7 - expect truthy value
            ok 8 - expect truthy value
            ok 9 - should be equal
            ok 10 - should be equal
            1..10
        ok 6 - addTrack # time=46.685ms

        # Subtest: audio only unpublish
            1..2
            ok 1 - should be equal
            ok 2 - should be equal
        ok 7 - audio only unpublish # time=14.042ms

        # Subtest: audio only loudestK
            1..3
            ok 1 - expect truthy value
            ok 2 - should be equal
            ok 3 - should be equal
        ok 8 - audio only loudestK # time=15.807ms

        1..8
    ok 3 - Participant::publish # time=310.786ms

    # Subtest: Participant::screenshare
        # Subtest: success
            1..8
            ok 1 - should be equal
            ok 2 - should be equal
            ok 3 - expect truthy value
            ok 4 - should be equal
            ok 5 - should be equal
            ok 6 - should be equal
            ok 7 - should be equal
            ok 8 - should be equal
        ok 1 - success # time=17.574ms

        # Subtest: no self subscribe
            1..5
            ok 1 - should be equal
            ok 2 - should be equal
            ok 3 - should be equal
            ok 4 - should be equal
            ok 5 - should be equal
        ok 2 - no self subscribe # time=6.063ms

        # Subtest: no lastN
            1..5
            ok 1 - should be equal
            ok 2 - should be equal
            ok 3 - should be equal
            ok 4 - should be equal
            ok 5 - should be equal
        ok 3 - no lastN # time=4.935ms

        # Subtest: late lastN
            1..8
            ok 1 - should be equal
            ok 2 - should be equal
            ok 3 - should be equal
            ok 4 - should be equal
            ok 5 - should be equal
            ok 6 - should be equal
            ok 7 - should be equal
            ok 8 - expect truthy value
        ok 4 - late lastN # time=5.426ms

        # Subtest: overthrown
            1..1
            ok 1 - expect truthy value
        ok 5 - overthrown # time=3.354ms

        # Subtest: self overthrown
            1..1
            ok 1 - expect truthy value
        ok 6 - self overthrown # time=2.284ms

        1..6
    ok 4 - Participant::screenshare # time=55.82ms

    # Subtest: Participant::subscribe
        # Subtest: ss+cam
            1..3
            ok 1 - expect truthy value
            ok 2 - expect truthy value
            ok 3 - expect truthy value
        ok 1 - ss+cam # time=6.921ms

        # Subtest: other ss+cam
            1..4
            ok 1 - expect truthy value
            ok 2 - expect truthy value
            ok 3 - expect truthy value
            ok 4 - expect truthy value
        ok 2 - other ss+cam # time=127.919ms

        # Subtest: setProfiles
            1..3
            ok 1 - expect truthy value
            ok 2 - should be equal
            ok 3 - should be equal
        ok 3 - setProfiles # time=228.751ms

        1..3
    ok 5 - Participant::subscribe # time=1354.091ms

    1..5
    # time=1807.297ms
ok 2 - tests/participant.js # time=2178.332ms

# Subtest: tests/room.js
    # Subtest: Room::constructor
        # Subtest: getters
            ok 1 - expect truthy value
            ok 2 - should be equal
            1..2
        ok 1 - getters # time=2.712ms

        # Subtest: isAdmin
            ok 1 - expect truthy value
            ok 2 - expect truthy value
            1..2
        ok 2 - isAdmin # time=0.831ms

        1..2
    ok 1 - Room::constructor # time=15.86ms

    # Subtest: Room::createParticipant
        # Subtest: success
            1..2
            ok 1 - should be equal
            ok 2 - expect truthy value
        ok 1 - success # time=2.83ms

        # Subtest: two
            1..4
            ok 1 - should be equal
            ok 2 - expect truthy value
            ok 3 - should be equal
            ok 4 - expect truthy value
        ok 2 - two # time=2.044ms

        # Subtest: duplicate
            ok 1 - should be equal
            1..1
        ok 3 - duplicate # time=1.947ms

        1..3
    ok 2 - Room::createParticipant # time=15.697ms

    # Subtest: Room::getParticipantIds
        # Subtest: success
            ok 1 - should be equal
            ok 2 - should be equal
            ok 3 - should be equal
            1..3
        ok 1 - success # time=2.185ms

        1..1
    ok 3 - Room::getParticipantIds # time=4.454ms

    # Subtest: SFU::kickParticipant
        # Subtest: success
            1..4
            ok 1 - (unnamed test)
            ok 2 - (unnamed test)
            ok 3 - should be equal
            ok 4 - should be equal
        ok 1 - success # time=1.946ms

        # Subtest: not found
            ok 1 - expect truthy value
            ok 2 - should be equal
            1..2
        ok 2 - not found # time=1.563ms

        1..2
    ok 4 - SFU::kickParticipant # time=8.44ms

    1..4
    # time=63.624ms
ok 3 - tests/room.js # time=405.203ms

# Subtest: tests/sfu.js
    # Subtest: SFU::createRoom
        # Subtest: success
            ok 1 - expect truthy value
            ok 2 - expect truthy value
            1..2
        ok 1 - success # time=4.935ms

        # Subtest: no pin
            ok 1 - should be equal
            1..1
        ok 2 - no pin # time=0.961ms

        1..2
    ok 1 - SFU::createRoom # time=16.813ms

    # Subtest: SFU::hasRoom
        # Subtest: success
            ok 1 - expect truthy value
            ok 2 - expect truthy value
            1..2
        ok 1 - success # time=1.448ms

        # Subtest: no room
            ok 1 - expect truthy value
            1..1
        ok 2 - no room # time=0.504ms

        1..2
    ok 2 - SFU::hasRoom # time=7.165ms

    # Subtest: SFU::getRoom
        # Subtest: success
            ok 1 - expect truthy value
            ok 2 - expect truthy value
            1..2
        ok 1 - success # time=1.282ms

        # Subtest: no room
            ok 1 - should be equal
            1..1
        ok 2 - no room # time=0.624ms

        1..2
    ok 3 - SFU::getRoom # time=7.118ms

    1..3
    # time=46.489ms
ok 4 - tests/sfu.js # time=395.315ms

1..4
# time=3525.735ms
---------------------|----------|----------|----------|----------|-------------------|
File                 |  % Stmts | % Branch |  % Funcs |  % Lines | Uncovered Line #s |
---------------------|----------|----------|----------|----------|-------------------|
All files            |    83.31 |    58.92 |    86.89 |     83.2 |                   |
 lib                 |    74.58 |    58.64 |    81.48 |    74.25 |                   |
  Client.js          |    42.91 |    35.19 |     38.1 |    42.91 |... 85,688,689,692 |
  Config.js          |       80 |      100 |      100 |       80 |                 7 |
  ErrorCodes.js      |      100 |      100 |      100 |      100 |                   |
  Errors.js          |      100 |       50 |      100 |      100 |                 9 |
  Logger.js          |    77.78 |       25 |      100 |    77.78 |        9,10,11,13 |
  Participant.js     |    85.43 |     64.4 |    90.74 |    85.09 |... 1106,1115,1123 |
  Recorder.js        |    93.33 |    66.67 |      100 |    93.33 |                15 |
  RecorderFactory.js |      100 |      100 |      100 |      100 |                   |
  Room.js            |    82.08 |    59.38 |    79.31 |    82.35 |... 98,400,403,451 |
  SFU.js             |      100 |      100 |      100 |      100 |                   |
  Stats.js           |    96.15 |      100 |       90 |    96.15 |                23 |
  StatsFlusher.js    |      100 |      100 |      100 |      100 |                   |
  StreamKind.js      |    88.89 |      100 |      100 |    88.89 |                20 |
 tests               |    93.59 |      100 |    92.42 |    93.56 |                   |
  client.js          |    91.82 |      100 |      100 |    91.76 |... 14,537,559,577 |
  participant.js     |    95.42 |      100 |    85.48 |    95.41 |... 20,469,594,629 |
  room.js            |    93.64 |      100 |       95 |    93.64 |... 17,151,188,205 |
  sfu.js             |    90.16 |      100 |      100 |    90.16 |24,34,62,73,98,108 |
---------------------|----------|----------|----------|----------|-------------------|
